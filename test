# 2. Préparer le fichier de sortie
          echo '{"jira_details": []}' > enriched_jira_data.json
          
          # 3. Boucler et interroger l'API JIRA (Utilisation de l'API REST v2)
          # Utilisation de l'authentification de base (nom d'utilisateur et jeton API)
          
          for JIRA_ID in $JIRA_LIST; do
            echo "Interrogation de JIRA pour : $JIRA_ID"
            
            # Utilisation de l'API REST JIRA pour obtenir les détails
            JIRA_RESPONSE=$(curl -s -X GET \
              --user "$JIRA_USER:$JIRA_TOKEN" \
              "https://$JIRA_DOMAIN/rest/api/2/issue/$JIRA_ID" \
              -H "Accept: application/json")
              
            # Vérifier si la réponse contient une erreur (par ex. "issue does not exist")
            if echo "$JIRA_RESPONSE" | jq -e 'has("errorMessages") or has("errors")' > /dev/null; then
              echo "Avertissement: Échec de la récupération pour $JIRA_ID. Erreur JIRA."
              # Créer un objet d'erreur simple
              JIRA_DETAIL='{"key": "'"$JIRA_ID"'", "error": "JIRA_API_ERROR"}'
            else
              # Ajouter la clé pour s'assurer que l'ID est toujours là
              JIRA_DETAIL=$(echo "$JIRA_RESPONSE" | jq --arg key "$JIRA_ID" '. + { "key": $key }')
            fi
            
            # Ajouter les détails au fichier de sortie
            # Utilise jq pour fusionner le nouvel objet JSON dans le tableau existant
            TEMP_FILE=$(mktemp)
            jq --argjson detail "$JIRA_DETAIL" '.jira_details += [$detail]' enriched_jira_data.json > "$TEMP_FILE" && mv "$TEMP_FILE" enriched_jira_data.json
          done
          
          echo "Résultat JSON final (enriched_jira_data.json) :"
          cat enriched_jira_data.json
          
          # Rendre le fichier disponible pour l'artefact
          echo "output_file=enriched_jira_data.json" >> $GITHUB_OUTPUT


      - name: Publier le fichier JSON enrichi comme Artefact
        uses: actions/upload-artifact@v4
        with:
          name: donnees-jira-enrichies
          path: enriched_jira_data.json
          retention-days: 7
